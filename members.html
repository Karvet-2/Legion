<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Участники гильдии - Legion</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="py-3">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6">
            <h1 class="mb-0">
              <a href="index.html" class="text-white text-decoration-none">
                <i class="fas fa-dragon me-2"></i>Legion
              </a>
            </h1>
          </div>
          <div class="col-md-6">
            <nav class="navbar navbar-expand-lg navbar-dark">
              <button
                class="navbar-toggler"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbarNav"
              >
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                  <li class="nav-item">
                    <a class="nav-link" href="index.html">
                      <i class="fas fa-home me-1"></i> Главная
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link active" href="members.html">
                      <i class="fas fa-users me-1"></i> Участники
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="events.html">
                      <i class="fas fa-calendar-alt me-1"></i> События
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="packs.html">
                      <i class="fas fa-layer-group me-1"></i> Круги
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="statistics.html">
                      <i class="fas fa-chart-bar me-1"></i> Статистика
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="#" id="logoutBtn">
                      <i class="fas fa-sign-out-alt me-1"></i> Выход
                    </a>
                  </li>
                </ul>
              </div>
            </nav>
          </div>
        </div>
      </div>
    </header>

    <div class="container mt-5">
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div
              class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
            >
              <h2 class="mb-0">
                <i class="fas fa-users me-2"></i> Участники гильдии
              </h2>
              <button
                class="btn btn-light"
                data-bs-toggle="modal"
                data-bs-target="#addMemberModal"
              >
                <i class="fas fa-user-plus me-2"></i> Добавить участника
              </button>
            </div>
            <div class="card-body">
              <div class="row mb-4">
                <div class="col-md-6 mb-3 mb-md-0">
                  <div class="input-group">
                    <span class="input-group-text bg-light">
                      <i class="fas fa-search text-primary"></i>
                    </span>
                    <input
                      type="text"
                      id="tableFilter"
                      class="form-control"
                      placeholder="Поиск по участникам..."
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="input-group">
                    <span class="input-group-text bg-light">
                      <i class="fas fa-filter text-primary"></i>
                    </span>
                    <select id="packFilter" class="form-select">
                      <option value="0">Все круги</option>
                      <!-- Круги будут добавлены из JavaScript -->
                    </select>
                  </div>
                </div>
              </div>

              <div id="membersTableContainer">
                <div class="alert alert-info">
                  <i class="fas fa-spinner fa-spin me-2"></i> Загрузка данных...
                </div>
              </div>
            </div>
            <div class="card-footer">
              <div class="d-flex justify-content-between">
                <span>
                  <i class="fas fa-users me-2"></i>
                  Всего участников:
                  <strong id="totalMembers" class="text-primary">0</strong>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Модальное окно добавления участника -->
    <div
      class="modal fade"
      id="addMemberModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title">
              <i class="fas fa-user-plus me-2"></i> Добавление нового участника
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addMemberForm">
              <div class="mb-3">
                <label for="nickname" class="form-label">
                  <i class="fas fa-user me-2"></i>Ник *
                </label>
                <input
                  type="text"
                  class="form-control"
                  id="nickname"
                  required
                  placeholder="Введите никнейм участника"
                />
              </div>

              <div class="mb-3">
                <label for="telegramUsername" class="form-label">
                  <i class="fab fa-telegram me-2"></i>Ник в Telegram
                </label>
                <input
                  type="text"
                  class="form-control"
                  id="telegramUsername"
                  placeholder="Введите ник в Telegram (без @)"
                />
              </div>

              <div class="mb-3">
                <label for="class" class="form-label">
                  <i class="fas fa-hat-wizard me-2"></i>Класс *
                </label>
                <select class="form-select" id="class" required>
                  <option value="">Выберите класс</option>
                  <option value="Страж">Страж</option>
                  <option value="Друид">Друид</option>
                  <option value="Жнец">Жнец</option>
                  <option value="Стрелок">Стрелок</option>
                  <option value="Жрец">Жрец</option>
                  <option value="Лучник">Лучник</option>
                  <option value="Оккультист">Оккультист</option>
                  <option value="Маг">Маг</option>
                  <option value="Воин">Воин</option>
                  <option value="Чародей">Чародей</option>
                  <option value="Призрак">Призрак</option>
                  <option value="Убийца">Убийца</option>
                  <option value="Оборотень">Оборотень</option>
                </select>
              </div>

              <div class="mb-3">
                <label for="battlePower" class="form-label">
                  <i class="fas fa-fist-raised me-2"></i>БМ
                </label>
                <input
                  type="number"
                  class="form-control"
                  id="battlePower"
                  min="1"
                  value="1000"
                  placeholder="Боевая мощь персонажа"
                />
              </div>

              <div class="mb-3">
                <label for="packId" class="form-label">
                  <i class="fas fa-layer-group me-2"></i>Круг
                </label>
                <select class="form-select" id="packId">
                  <option value="0">Без круга</option>
                  <!-- Круги будут добавлены из JavaScript -->
                </select>
              </div>

              <div class="mb-3 form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="active"
                  checked
                />
                <label class="form-check-label" for="active">
                  <i class="fas fa-check-circle me-1"></i>Активен
                </label>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              <i class="fas fa-times me-2"></i>Отмена
            </button>
            <button type="button" class="btn btn-primary" id="saveMemberBtn">
              <i class="fas fa-save me-2"></i>Сохранить
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Модальное окно редактирования участника -->
    <div
      class="modal fade"
      id="editMemberModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title">
              <i class="fas fa-user-edit me-2"></i> Редактирование участника
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="editMemberForm">
              <input type="hidden" id="editMemberId" />
              <div class="mb-3">
                <label for="editNickname" class="form-label">
                  <i class="fas fa-user me-2"></i>Ник *
                </label>
                <input
                  type="text"
                  class="form-control"
                  id="editNickname"
                  required
                />
              </div>

              <div class="mb-3">
                <label for="editTelegramUsername" class="form-label">
                  <i class="fab fa-telegram me-2"></i>Ник в Telegram
                </label>
                <input
                  type="text"
                  class="form-control"
                  id="editTelegramUsername"
                />
              </div>

              <div class="mb-3">
                <label for="editClass" class="form-label">
                  <i class="fas fa-hat-wizard me-2"></i>Класс *
                </label>
                <select class="form-select" id="editClass" required>
                  <option value="">Выберите класс</option>
                  <option value="Страж">Страж</option>
                  <option value="Друид">Друид</option>
                  <option value="Жнец">Жнец</option>
                  <option value="Стрелок">Стрелок</option>
                  <option value="Жрец">Жрец</option>
                  <option value="Лучник">Лучник</option>
                  <option value="Оккультист">Оккультист</option>
                  <option value="Маг">Маг</option>
                  <option value="Воин">Воин</option>
                  <option value="Чародей">Чародей</option>
                  <option value="Призрак">Призрак</option>
                  <option value="Убийца">Убийца</option>
                  <option value="Оборотень">Оборотень</option>
                </select>
              </div>

              <div class="mb-3">
                <label for="editBattlePower" class="form-label">
                  <i class="fas fa-fist-raised me-2"></i>БМ
                </label>
                <input
                  type="number"
                  class="form-control"
                  id="editBattlePower"
                  min="1"
                />
              </div>

              <div class="mb-3">
                <label for="editPackId" class="form-label">
                  <i class="fas fa-layer-group me-2"></i>Круг
                </label>
                <select class="form-select" id="editPackId">
                  <option value="0">Без круга</option>
                  <!-- Круги будут добавлены из JavaScript -->
                </select>
              </div>

              <div class="mb-3">
                <label for="editNotes" class="form-label">
                  <i class="fas fa-sticky-note me-2"></i>Заметки
                </label>
                <textarea
                  class="form-control"
                  id="editNotes"
                  rows="3"
                ></textarea>
              </div>

              <div class="mb-3 form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="editActive"
                />
                <label class="form-check-label" for="editActive">
                  <i class="fas fa-check-circle me-1"></i>Активен
                </label>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-danger me-auto"
              id="deleteMemberBtn"
            >
              <i class="fas fa-trash-alt me-2"></i>Удалить
            </button>
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              <i class="fas fa-times me-2"></i>Отмена
            </button>
            <button type="button" class="btn btn-primary" id="updateMemberBtn">
              <i class="fas fa-save me-2"></i>Сохранить
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Модальное окно подтверждения удаления -->
    <div
      class="modal fade"
      id="deleteConfirmModal"
      tabindex="-1"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content">
          <div class="modal-header bg-danger text-white">
            <h5 class="modal-title">
              <i class="fas fa-exclamation-triangle me-2"></i> Подтверждение
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>
              Вы действительно хотите удалить участника
              <strong id="deleteUserName"></strong>?
            </p>
            <p class="text-danger">
              <i class="fas fa-exclamation-circle me-2"></i>Это действие нельзя
              отменить!
            </p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              <i class="fas fa-times me-2"></i>Отмена
            </button>
            <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
              <i class="fas fa-trash-alt me-2"></i>Удалить
            </button>
          </div>
        </div>
      </div>
    </div>

    <footer class="py-4 mt-5">
      <div class="container">
        <div class="row">
          <div class="col-md-6">
            <h5><i class="fas fa-dragon me-2"></i> Гильдия Legion</h5>
            <p>
              Сайт для управления гильдией и отслеживания статистики участников.
            </p>
          </div>
          <div class="col-md-6 text-md-end">
            <div class="social-icons mb-3">
              <a href="#" class="text-light me-3"
                ><i class="fab fa-discord fa-lg"></i
              ></a>
              <a href="#" class="text-light me-3"
                ><i class="fab fa-telegram fa-lg"></i
              ></a>
              <a href="#" class="text-light"><i class="fab fa-vk fa-lg"></i></a>
            </div>
            <p>&copy; <span id="currentYear"></span> Все права защищены.</p>
          </div>
        </div>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
      // Инициализация Supabase для браузера через CDN
      const supabaseUrl = "https://rlfhdyfjovrlelrxtrhi.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJsZmhkeWZqb3ZybGVscnh0cmhpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg2MzczOTIsImV4cCI6MjA2NDIxMzM5Mn0.fovIsGABqoC0lXjuynuAW2tbEhlRBY9bGr8UUNJ39Uk";
      const supabaseClient = window.supabase.createClient(
        supabaseUrl,
        supabaseKey
      );

      document.getElementById("currentYear").textContent =
        new Date().getFullYear();

      // Проверка авторизации через Supabase Auth
      async function checkAuth() {
        try {
          const {
            data: { user },
            error: authError,
          } = await supabaseClient.auth.getUser();
          if (authError) {
            console.error("Ошибка авторизации:", authError);
            window.location.href = "login.html";
            return false;
          }
          if (!user) {
            console.log("Пользователь не авторизован");
            window.location.href = "login.html";
            return false;
          }
          const { data, error } = await supabaseClient
            .from("users")
            .select("role")
            .eq("id", user.id)
            .single();
          if (error) {
            console.error("Ошибка получения роли пользователя:", error);
            window.location.href = "login.html";
            return false;
          }
          if (!data) {
            console.log("Пользователь не найден в базе");
            window.location.href = "login.html";
            return false;
          }
          if (data.role !== "admin") {
            console.log("Недостаточно прав");
            window.location.href = "statistics.html";
            return false;
          }
          console.log("Авторизация успешна");
          return true;
        } catch (err) {
          console.error("Неожиданная ошибка при проверке авторизации:", err);
          window.location.href = "login.html";
          return false;
        }
      }

      // Получить все круги
      async function getAllPacks() {
        try {
          const { data, error } = await supabaseClient
            .from("packs")
            .select("*");
          if (error) {
            console.error("Ошибка загрузки кругов:", error);
            alert("Ошибка загрузки кругов: " + error.message);
            return [];
          }
          console.log("Загружены круги:", data);
          return data;
        } catch (err) {
          console.error("Неожиданная ошибка при загрузке кругов:", err);
          alert("Произошла ошибка при загрузке кругов");
          return [];
        }
      }

      // Получить всех участников
      async function getAllMembers() {
        try {
          const { data, error } = await supabaseClient
            .from("members")
            .select("*");
          if (error) {
            console.error("Ошибка загрузки участников:", error);
            alert("Ошибка загрузки участников: " + error.message);
            return [];
          }
          console.log("Загружены участники:", data);
          return data;
        } catch (err) {
          console.error("Неожиданная ошибка при загрузке участников:", err);
          alert("Произошла ошибка при загрузке участников");
          return [];
        }
      }

      // Добавить участника
      async function saveMember(member) {
        try {
          const { data, error } = await supabaseClient
            .from("members")
            .insert([member]);
          if (error) {
            console.error("Ошибка добавления участника:", error);
            alert("Ошибка добавления участника: " + error.message);
            return null;
          }
          console.log("Участник добавлен:", data);
          return data;
        } catch (err) {
          console.error("Неожиданная ошибка при добавлении участника:", err);
          alert("Произошла ошибка при добавлении участника");
          return null;
        }
      }

      // Обновить участника
      async function updateMember(id, member) {
        try {
          const { data, error } = await supabaseClient
            .from("members")
            .update(member)
            .eq("id", id);
          if (error) {
            console.error("Ошибка обновления участника:", error);
            alert("Ошибка обновления: " + error.message);
            return false;
          }
          console.log("Участник обновлен:", data);
          return true;
        } catch (err) {
          console.error("Неожиданная ошибка при обновлении участника:", err);
          alert("Произошла ошибка при обновлении участника");
          return false;
        }
      }

      // Удалить участника
      async function deleteMember(id) {
        try {
          const { data, error } = await supabaseClient
            .from("members")
            .delete()
            .eq("id", id);
          if (error) {
            console.error("Ошибка удаления участника:", error);
            alert("Ошибка удаления: " + error.message);
            return false;
          }
          console.log("Участник удален:", data);
          return true;
        } catch (err) {
          console.error("Неожиданная ошибка при удалении участника:", err);
          alert("Произошла ошибка при удалении участника");
          return false;
        }
      }

      // Добавить круг
      async function savePack(pack) {
        try {
          const { data, error } = await supabaseClient
            .from("packs")
            .insert([pack]);
          if (error) {
            console.error("Ошибка добавления круга:", error);
            alert("Ошибка добавления круга: " + error.message);
            return null;
          }
          console.log("Круг добавлен:", data);
          return data;
        } catch (err) {
          console.error("Неожиданная ошибка при добавлении круга:", err);
          alert("Произошла ошибка при добавлении круга");
          return null;
        }
      }

      // Обновить круг
      async function updatePack(id, pack) {
        try {
          const { data, error } = await supabaseClient
            .from("packs")
            .update(pack)
            .eq("id", id);
          if (error) {
            console.error("Ошибка обновления круга:", error);
            alert("Ошибка обновления круга: " + error.message);
            return false;
          }
          console.log("Круг обновлен:", data);
          return true;
        } catch (err) {
          console.error("Неожиданная ошибка при обновлении круга:", err);
          alert("Произошла ошибка при обновлении круга");
          return false;
        }
      }

      // Удалить круг
      async function deletePack(id) {
        try {
          const { data, error } = await supabaseClient
            .from("packs")
            .delete()
            .eq("id", id);
          if (error) {
            console.error("Ошибка удаления круга:", error);
            alert("Ошибка удаления круга: " + error.message);
            return false;
          }
          console.log("Круг удален:", data);
          return true;
        } catch (err) {
          console.error("Неожиданная ошибка при удалении круга:", err);
          alert("Произошла ошибка при удалении круга");
          return false;
        }
      }

      // Загрузка списка кругов
      async function loadPacks() {
        const packs = await getAllPacks();
        const packFilter = document.getElementById("packFilter");
        const packId = document.getElementById("packId");
        const editPackId = document.getElementById("editPackId");
        packFilter.innerHTML = '<option value="0">Все круги</option>';
        packId.innerHTML = '<option value="0">Без круга</option>';
        editPackId.innerHTML = '<option value="0">Без круга</option>';
        packs.forEach((pack) => {
          const option1 = document.createElement("option");
          option1.value = pack.id;
          option1.textContent = pack.name;
          packFilter.appendChild(option1);
          const option2 = document.createElement("option");
          option2.value = pack.id;
          option2.textContent = pack.name;
          packId.appendChild(option2);
          const option3 = document.createElement("option");
          option3.value = pack.id;
          option3.textContent = pack.name;
          editPackId.appendChild(option3);
        });
      }

      // Загрузка списка участников
      async function loadMembers() {
        const members = await getAllMembers();
        const packs = await getAllPacks();
        const container = document.getElementById("membersTableContainer");
        const totalMembersElement = document.getElementById("totalMembers");
        totalMembersElement.textContent = members.length;
        if (members.length === 0) {
          container.innerHTML =
            '<div class="alert alert-info">Участники гильдии не найдены. Добавьте первого участника!</div>';
          return;
        }
        let html = `<div class="table-responsive"><table class="table table-striped table-hover filterable-table"><thead><tr><th>#</th><th>Ник</th><th>Telegram</th><th>Класс</th><th>БМ</th><th>Круг</th><th>Действия</th></tr></thead><tbody>`;
        members.forEach((member, index) => {
          let packName = "Не назначен";
          const pack = packs.find((p) => p.id === member.pack_id);
          if (pack) {
            packName = pack.name;
          }
          html += `<tr data-pack-id="${member.pack_id || 0}"><td>${
            index + 1
          }</td><td>${member.nickname || "-"}</td><td>${
            member.telegram_username || "-"
          }</td><td><span class="class-icon class-${(
            member.class || ""
          ).toLowerCase()}"></span>${member.class || "-"}</td><td>${
            member.battle_power || 1000
          }</td><td>${packName}</td><td><button class="btn btn-sm btn-primary edit-member" data-id="${
            member.id
          }">Редактировать</button><button class="btn btn-sm btn-danger delete-member delete-confirm" data-id="${
            member.id
          }">Удалить</button></td></tr>`;
        });
        html += `</tbody></table></div>`;
        container.innerHTML = html;
        document.querySelectorAll(".edit-member").forEach((btn) => {
          btn.addEventListener("click", async function () {
            const id = parseInt(this.getAttribute("data-id"));
            const { data, error } = await supabaseClient
              .from("members")
              .select("*")
              .eq("id", id)
              .single();
            if (error || !data) {
              alert("Ошибка загрузки участника для редактирования");
              return;
            }
            document.getElementById("editMemberId").value = data.id;
            document.getElementById("editNickname").value = data.nickname || "";
            document.getElementById("editTelegramUsername").value =
              data.telegram_username || "";
            document.getElementById("editClass").value = data.class || "";
            document.getElementById("editBattlePower").value =
              data.battle_power || 1000;
            document.getElementById("editPackId").value = data.pack_id || 0;
            const modal = new bootstrap.Modal(
              document.getElementById("editMemberModal")
            );
            modal.show();
          });
        });
        document.querySelectorAll(".delete-member").forEach((btn) => {
          btn.addEventListener("click", async function () {
            const id = parseInt(this.getAttribute("data-id"));
            if (confirm("Вы уверены, что хотите удалить этого участника?")) {
              await deleteMember(id);
              await loadMembers();
            }
          });
        });
      }

      document.addEventListener("DOMContentLoaded", async function () {
        const isAuth = await checkAuth();
        if (!isAuth) return;
        loadPacks();
        loadMembers();
        document
          .getElementById("saveMemberBtn")
          .addEventListener("click", async function () {
            const nickname = document.getElementById("nickname").value;
            const className = document.getElementById("class").value;
            const battlePower = parseInt(
              document.getElementById("battlePower").value
            );
            const packId = parseInt(document.getElementById("packId").value);
            const telegramUsername =
              document.getElementById("telegramUsername").value;
            if (!nickname || !className) {
              alert("Пожалуйста, заполните обязательные поля");
              return;
            }
            const member = {
              nickname: nickname,
              class: className,
              battle_power: battlePower,
              pack_id: packId === 0 ? null : packId,
              telegram_username: telegramUsername,
            };
            await saveMember(member);
            const modal = bootstrap.Modal.getInstance(
              document.getElementById("addMemberModal")
            );
            modal.hide();
            document.getElementById("addMemberForm").reset();
            await loadMembers();
          });
        document
          .getElementById("updateMemberBtn")
          .addEventListener("click", async function () {
            const id = parseInt(document.getElementById("editMemberId").value);
            const nickname = document.getElementById("editNickname").value;
            const className = document.getElementById("editClass").value;
            const battlePower = parseInt(
              document.getElementById("editBattlePower").value
            );
            const packId = parseInt(
              document.getElementById("editPackId").value
            );
            const telegramUsername = document.getElementById(
              "editTelegramUsername"
            ).value;
            if (!nickname || !className) {
              alert("Пожалуйста, заполните обязательные поля");
              return;
            }
            const member = {
              nickname: nickname,
              class: className,
              battle_power: battlePower,
              pack_id: packId === 0 ? null : packId,
              telegram_username: telegramUsername,
            };
            await updateMember(id, member);
            const modal = bootstrap.Modal.getInstance(
              document.getElementById("editMemberModal")
            );
            modal.hide();
            await loadMembers();
          });
      });
    </script>
  </body>
</html>
